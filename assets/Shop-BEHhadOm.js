import{c as O,I as F,z as X,d as Y,v as Z,a as j,r as $,w as te,A as U,l as H,D as se,o as p,f as t,t as i,b as v,g as x,B as L,E as oe,F as K,x as A,y as q,q as ne,H as ae,C as Q,M as I,_ as ee,i as le,j as ce,k as re,u as D,S as T,e as ie,h as ue}from"./index-tmk96ooy.js";import{E as de}from"./el-button-Bl-XyZxP.js";var pe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M744 62H280c-35.3 0-64 28.7-64 64v768c0 35.3 28.7 64 64 64h464c35.3 0 64-28.7 64-64V126c0-35.3-28.7-64-64-64zm-8 824H288V134h448v752zM472 784a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"mobile",theme:"outlined"};function W(n){for(var o=1;o<arguments.length;o++){var s=arguments[o]!=null?Object(arguments[o]):{},c=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(s).filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable}))),c.forEach(function(r){me(n,r,s[r])})}return n}function me(n,o,s){return o in n?Object.defineProperty(n,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[o]=s,n}var N=function(o,s){var c=W({},o,s.attrs);return O(F,W({},c,{icon:pe}),null)};N.displayName="MobileOutlined";N.inheritAttrs=!1;var he={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M468 128H160c-17.7 0-32 14.3-32 32v308c0 4.4 3.6 8 8 8h332c4.4 0 8-3.6 8-8V136c0-4.4-3.6-8-8-8zm-56 284H192V192h220v220zm-138-74h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm194 210H136c-4.4 0-8 3.6-8 8v308c0 17.7 14.3 32 32 32h308c4.4 0 8-3.6 8-8V556c0-4.4-3.6-8-8-8zm-56 284H192V612h220v220zm-138-74h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm590-630H556c-4.4 0-8 3.6-8 8v332c0 4.4 3.6 8 8 8h332c4.4 0 8-3.6 8-8V160c0-17.7-14.3-32-32-32zm-32 284H612V192h220v220zm-138-74h56c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8h-56c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm194 210h-48c-4.4 0-8 3.6-8 8v134h-78V556c0-4.4-3.6-8-8-8H556c-4.4 0-8 3.6-8 8v332c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V644h78v102c0 4.4 3.6 8 8 8h190c4.4 0 8-3.6 8-8V556c0-4.4-3.6-8-8-8zM746 832h-48c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zm142 0h-48c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}}]},name:"qrcode",theme:"outlined"};function R(n){for(var o=1;o<arguments.length;o++){var s=arguments[o]!=null?Object(arguments[o]):{},c=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(s).filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable}))),c.forEach(function(r){ve(n,r,s[r])})}return n}function ve(n,o,s){return o in n?Object.defineProperty(n,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[o]=s,n}var E=function(o,s){var c=R({},o,s.attrs);return O(F,R({},c,{icon:he}),null)};E.displayName="QrcodeOutlined";E.inheritAttrs=!1;var fe={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V144c0-17.7-14.3-32-32-32zm-40 464H528V448h312v128zm0 264H184V184h656v200H496c-17.7 0-32 14.3-32 32v192c0 17.7 14.3 32 32 32h344v200zM580 512a40 40 0 1080 0 40 40 0 10-80 0z"}}]},name:"wallet",theme:"outlined"};function J(n){for(var o=1;o<arguments.length;o++){var s=arguments[o]!=null?Object(arguments[o]):{},c=Object.keys(s);typeof Object.getOwnPropertySymbols=="function"&&(c=c.concat(Object.getOwnPropertySymbols(s).filter(function(r){return Object.getOwnPropertyDescriptor(s,r).enumerable}))),c.forEach(function(r){ge(n,r,s[r])})}return n}function ge(n,o,s){return o in n?Object.defineProperty(n,o,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[o]=s,n}var G=function(o,s){var c=J({},o,s.attrs);return O(F,J({},c,{icon:fe}),null)};G.displayName="WalletOutlined";G.inheritAttrs=!1;const _e=async()=>{const n=await X.get({url:"/api/h5/mall/shopBuyGoodsList",params:{zytm:Date.now()}});return n.code===0&&console.log(`getShopGoodList success: ${n.message}`),n},be=async(n,o,s,c)=>{const r={gid:n,mode:o,isSpe:0,oid:"",format:{email:"",name:s,cpf:c,country:"",phone:""},tid:"",sand:"",tracking:""},f=await X.post({url:"/api/h5/mall/pay",data:r});return console.log("payGood resp:",f),f.code===0&&console.log(`payGood success: ${f.message}`),f},ye={class:"purchase-content"},$e={class:"product-info"},Oe={class:"product-main-info"},Pe={class:"product-image"},Ve=["src","alt"],Se={class:"product-details"},ze={class:"coin-amount"},Me={class:"coins"},we={class:"currency"},Ce={class:"product-price-section"},ke={class:"price"},De={class:"amount"},Ie={class:"payment-section"},Be={class:"payment-methods"},He=["onClick"],je={class:"payment-icon"},Le={class:"form-group"},Fe=["placeholder","disabled"],Ne={class:"form-group"},Ee=["placeholder","disabled"],Ge={class:"purchase-footer"},Ue=Y({__name:"PurchaseDialog",props:{modelValue:{type:Boolean},product:{},payModes:{}},emits:["update:modelValue","close","submit"],setup(n,{emit:o}){const s=n,c=o,{t:r}=Z(),f=j({get:()=>s.modelValue,set:a=>c("update:modelValue",a)}),h=$(null),d=$({name:"",cpf:""}),S=()=>{h.value=null,d.value={name:"",cpf:""}};te(()=>s.modelValue,a=>{a&&S()});const _=j(()=>h.value&&d.value.name.trim()&&d.value.cpf.trim()&&s.product),b=$(!1),C=a=>a.toLocaleString(),B=a=>(a/100).toFixed(2),k=a=>{let g=a.target.value.replace(/\D/g,"");g.length<=11&&(g=g.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/,"$1.$2.$3-$4"),d.value.cpf=g)},z=a=>({1:Q,2:ae,3:N,4:E,5:G})[a]||Q,M=()=>{c("update:modelValue",!1),c("close")},P=async()=>{if(!(!_.value||!s.product)&&h.value!==null){console.log("Purchase submitted:",{payMode:h.value,userInfo:d.value,product:s.product}),b.value=!0;try{const a=h.value,m=await be(s.product.id,a,d.value.name,d.value.cpf);m.code===0?console.log("payGood success:",m.message):I.error(m.message??r("shop.purchaseFailed"))}catch(a){console.log("payGood failed:",a)}finally{b.value=!1}}};return(a,m)=>{const g=de;return p(),U(se,{modelValue:f.value,"onUpdate:modelValue":m[2]||(m[2]=V=>f.value=V),title:a.$t("shop.purchaseTitle"),width:"100%",top:"0","close-on-click-modal":!1,"close-on-press-escape":!0,onClose:M},{footer:H(()=>[t("div",Ge,[t("button",{class:"btn-cancel",onClick:M},i(a.$t("common.cancel")),1),O(g,{type:"success",size:"large",class:"btn-submit",disabled:!_.value||b.value,onClick:P},{default:H(()=>[ne(i(a.$t("shop.submit")),1)]),_:1},8,["disabled"])])]),default:H(()=>{var V,w,e,u;return[t("div",ye,[t("div",$e,[t("div",Oe,[t("div",Pe,[t("img",{src:((V=a.product)==null?void 0:V.image)||"/default-coin.svg",alt:(w=a.product)==null?void 0:w.name},null,8,Ve)]),t("div",Se,[t("div",ze,[t("span",Me,i(C(((e=a.product)==null?void 0:e.coins)||0)),1),t("span",we,i(a.$t("shop.coins")),1)]),t("div",Ce,[t("div",ke,[t("span",De,"R$ "+i(B(((u=a.product)==null?void 0:u.price)||0)),1)])])])])]),t("div",Ie,[t("h4",null,i(a.$t("shop.choosePayment")),1),t("div",Be,[(p(!0),v(K,null,x(a.payModes,l=>(p(),v("div",{key:l.mode,class:L(["payment-method",{active:h.value===l.mode}]),onClick:y=>h.value=l.mode},[t("div",je,[(p(),U(oe(z(l.mode))))]),t("span",null,i(l.desc),1)],10,He))),128))])]),t("div",{class:L(["user-info-section",{disabled:!h.value}])},[t("div",Le,[t("label",null,i(a.$t("shop.name")),1),A(t("input",{type:"text","onUpdate:modelValue":m[0]||(m[0]=l=>d.value.name=l),placeholder:a.$t("shop.namePlaceholder"),disabled:!h.value,class:"form-input"},null,8,Fe),[[q,d.value.name]])]),t("div",Ne,[t("label",null,i(a.$t("shop.cpf")),1),A(t("input",{type:"text","onUpdate:modelValue":m[1]||(m[1]=l=>d.value.cpf=l),placeholder:a.$t("shop.cpfPlaceholder"),disabled:!h.value,class:"form-input",onInput:k},null,40,Ee),[[q,d.value.cpf]])])],2)])]}),_:1},8,["modelValue","title"])}}}),Ae=ee(Ue,[["__scopeId","data-v-52bc846f"]]),qe={class:"shop-page"},Qe={class:"container"},Te={key:0,class:"not-logged-in"},We={class:"login-prompt"},Re={class:"icon"},Je={key:1},Xe={key:0,class:"loading-state"},Ye={key:1,class:"products-grid"},Ze={key:0,class:"bonus-badge"},xe={class:"product-image"},Ke=["src","alt"],et={class:"product-info"},tt={class:"product-name"},st={key:0,class:"coin-amount"},ot={class:"coins"},nt={class:"currency"},at={key:1,class:"coin-amount bonus"},lt={class:"coins"},ct={class:"original-amount"},rt=["onClick"],it={class:"price-value"},ut={key:2,class:"no-products"},dt={class:"empty-state"},pt=Y({__name:"Shop",setup(n){const{t:o}=Z(),s=le(),c=ce(),r=$(!1),f=$([]),h=$([]),d=$(!1),S=$(null);j(()=>(s.isLoggedIn&&w(),s.isLoggedIn));const _=e=>e.gift.type===0&&e.gift.sval>0,b=e=>e.gift.type===0?e.gift.num:0,C=e=>e.gift.type===0?e.gift.num+e.gift.sval:0,B=e=>_(e)?Math.round(e.gift.sval/e.gift.num*100):0,k=e=>e.price,z=e=>e.name||`${P(b(e))} ${o("shop.coins")}`,M=e=>`${ue().resUrl}/${e.image}`||"/default-coin.svg",P=e=>e.toLocaleString(),a=e=>(e/100).toFixed(2),m=e=>{S.value={id:e.id,name:z(e),image:M(e),coins:_(e)?C(e):b(e),price:k(e)},d.value=!0},g=()=>{d.value=!1,S.value=null},V=e=>{console.log("Purchase data:",e),I.success(o("shop.purchaseSuccess")),g()},w=async()=>{if(s.isLoggedIn){r.value=!0;try{const e=await _e();e.code===0?(f.value=e.data.list.map((u,l)=>{let y=u.gift[0];return{id:u.id||l+1,name:u.name||"",image:u.url||"",price:u.price||0,gift:{type:y.type||0,num:y.num||0,sval:y!=null&&y.sval?Number(y.sval):0}}}),h.value=e.data.payMode||[]):I.error(e.message||"Failed to load products")}catch(e){console.error("Failed to fetch products:",e),I.error(o("shop.purchaseError"))}finally{r.value=!1}}};return re(()=>{s.isLoggedIn&&w()}),(e,u)=>(p(),v("div",qe,[t("div",Qe,[D(s).isLoggedIn?(p(),v("div",Je,[r.value?(p(),v("div",Xe,[u[2]||(u[2]=t("div",{class:"loading-spinner"},null,-1)),t("p",null,i(e.$t("shop.loading")),1)])):f.value.length>0?(p(),v("div",Ye,[(p(!0),v(K,null,x(f.value,l=>(p(),v("div",{key:l.id,class:L(["product-card",{"has-bonus":_(l)}])},[_(l)?(p(),v("div",Ze," +"+i(B(l))+"% ",1)):ie("",!0),t("div",xe,[t("img",{src:M(l),alt:z(l)},null,8,Ke)]),t("div",et,[t("h4",tt,i(z(l)),1),_(l)?(p(),v("div",at,[t("span",null,[t("span",lt,i(P(C(l))),1),t("span",ct,i(P(b(l))),1)])])):(p(),v("div",st,[t("span",ot,i(P(b(l))),1),t("span",nt,i(e.$t("shop.coins")),1)])),t("button",{class:"buy-button",onClick:y=>m(l)},[u[3]||(u[3]=t("span",{class:"price-label"},"R$",-1)),t("span",it,i(a(k(l))),1)],8,rt)])],2))),128))])):(p(),v("div",ut,[t("div",dt,[O(D(T)),t("p",null,i(e.$t("shop.noProducts")),1)])]))])):(p(),v("div",Te,[t("div",We,[t("div",Re,[O(D(T))]),t("h3",null,i(e.$t("shop.notLoggedIn")),1),t("button",{class:"btn-login",onClick:u[0]||(u[0]=l=>D(c).showAuthModal("login"))},i(e.$t("shop.loginButton")),1)])]))]),O(Ae,{modelValue:d.value,"onUpdate:modelValue":u[1]||(u[1]=l=>d.value=l),product:S.value,payModes:h.value,onClose:g,onSubmit:V},null,8,["modelValue","product","payModes"])]))}}),vt=ee(pt,[["__scopeId","data-v-6867883d"]]);export{vt as default};
